"use strict";(self["webpackChunkstrapi_catalog_viewer"]=self["webpackChunkstrapi_catalog_viewer"]||[]).push([[541],{6541:function(e,t,a){a.r(t),a.d(t,{default:function(){return V}});var o=a(6768),n=a(4232),l=a(5130);const s={class:"container mt-4"},r={key:0,class:"text-center"},i={key:1,class:"alert alert-danger"},d={key:2},c={class:"d-flex justify-content-between align-items-center mb-3"},u=["href"],p=["href"],g={class:"catalog-container"},h=["onClick"],N={class:"card-body"},m={class:"products-grid"},k=["src","alt"],w=["onMousedown"],b=["onClick"],v={class:"page-number"},y={key:1,class:"page-placeholder"},f=["onClick"],C={class:"card-body"},D={class:"products-grid"},L=["src","alt"],E=["onMousedown"],X=["onClick"],_={class:"page-number"},x={key:3,class:"page-placeholder"};function M(e,t,a,M,I,$){return(0,o.uX)(),(0,o.CE)("div",s,[I.loading?((0,o.uX)(),(0,o.CE)("div",r,[...t[9]||(t[9]=[(0,o.Lk)("div",{class:"spinner-border",role:"status"},[(0,o.Lk)("span",{class:"visually-hidden"},"Chargement...")],-1)])])):(0,o.Q3)("",!0),I.error?((0,o.uX)(),(0,o.CE)("div",i,(0,n.v_)(I.error),1)):(0,o.Q3)("",!0),I.catalog?((0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("div",c,[(0,o.Lk)("h1",null,(0,n.v_)(I.catalog.title),1),(0,o.Lk)("button",{class:"btn btn-outline-primary",onClick:t[0]||(t[0]=(...e)=>$.toggleNoteMode&&$.toggleNoteMode(...e))},(0,n.v_)(I.isNoteMode?"Quitter le mode Notes":"Activer le mode Notes"),1)]),(0,o.Lk)("p",null,[(0,o.Lk)("a",{href:$.getStrapiMediaUrl(I.catalog.pdf_file_path),target:"_blank"},"Voir le PDF",8,u),t[10]||(t[10]=(0,o.eW)(" | ",-1)),(0,o.Lk)("a",{href:$.getStrapiMediaUrl(I.catalog.jpeg_preview_path),target:"_blank"},"Voir l'aperçu",8,p)]),t[11]||(t[11]=(0,o.Lk)("hr",null,null,-1)),t[12]||(t[12]=(0,o.Lk)("h2",null,"Pages",-1)),(0,o.Lk)("div",g,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)($.pairedPages,(e,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:"page-pair"},[e[0]?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"page left",onClick:t=>$.startNewNote(t,e[0])},[(0,o.Lk)("div",N,[(0,o.Lk)("div",m,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e[0].products,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"product-item"},[e.image?((0,o.uX)(),(0,o.CE)("img",{key:0,src:$.getStrapiMediaUrl(e.image.url),alt:e.name,class:"product-image"},null,8,k)):(0,o.Q3)("",!0),(0,o.Lk)("strong",null,(0,n.v_)(e.name),1),(0,o.Lk)("span",null,"$"+(0,n.v_)(e.price),1),(0,o.Lk)("p",null,(0,n.v_)(e.description),1)]))),128))])]),I.isNoteMode?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e[0].notes,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.documentId,class:(0,n.C4)(["note-bubble",{"is-dragging":I.draggedNote&&I.draggedNote.note.documentId===e.documentId}]),style:(0,n.Tr)({top:e.y+"px",left:e.x+"px"}),onMousedown:(0,l.D$)(t=>$.startDrag(t,e),["stop"])},[(0,o.Lk)("button",{onClick:(0,l.D$)(t=>$.deleteNote(e),["stop"]),class:"delete-note-btn"},"×",8,b),(0,o.Lk)("strong",null,(0,n.v_)(e.title),1),(0,o.Lk)("p",null,(0,n.v_)(e.content),1)],46,w))),128)),I.newNoteData&&I.newNoteData.page===e[0].id?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"new-note-form",style:(0,n.Tr)({top:I.newNoteData.y+"px",left:I.newNoteData.x+"px"})},[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>I.newNoteData.title=e),placeholder:"Titre",class:"form-control mb-2"},null,512),[[l.Jo,I.newNoteData.title]]),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>I.newNoteData.content=e),placeholder:"Votre note...",class:"form-control mb-2"},null,512),[[l.Jo,I.newNoteData.content]]),(0,o.Lk)("button",{onClick:t[3]||(t[3]=(0,l.D$)((...e)=>$.submitNewNote&&$.submitNewNote(...e),["stop"])),class:"btn btn-sm btn-primary"},"Enregistrer"),(0,o.Lk)("button",{onClick:t[4]||(t[4]=(0,l.D$)((...e)=>$.cancelNewNote&&$.cancelNewNote(...e),["stop"])),class:"btn btn-sm btn-secondary"},"Annuler")],4)):(0,o.Q3)("",!0)],64)):(0,o.Q3)("",!0),(0,o.Lk)("div",v,(0,n.v_)(e[0].page_number),1)],8,h)):((0,o.uX)(),(0,o.CE)("div",y)),e[1]?((0,o.uX)(),(0,o.CE)("div",{key:2,class:"page right",onClick:t=>$.startNewNote(t,e[1])},[(0,o.Lk)("div",C,[(0,o.Lk)("div",D,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e[1].products,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"product-item"},[e.image?((0,o.uX)(),(0,o.CE)("img",{key:0,src:$.getStrapiMediaUrl(e.image.url),alt:e.name,class:"product-image"},null,8,L)):(0,o.Q3)("",!0),(0,o.Lk)("strong",null,(0,n.v_)(e.name),1),(0,o.Lk)("span",null,"$"+(0,n.v_)(e.price),1),(0,o.Lk)("p",null,(0,n.v_)(e.description),1)]))),128))])]),I.isNoteMode?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e[1].notes,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.documentId,class:(0,n.C4)(["note-bubble",{"is-dragging":I.draggedNote&&I.draggedNote.note.documentId===e.documentId}]),style:(0,n.Tr)({top:e.y+"px",left:e.x+"px"}),onMousedown:(0,l.D$)(t=>$.startDrag(t,e),["stop"])},[(0,o.Lk)("button",{onClick:(0,l.D$)(t=>$.deleteNote(e),["stop"]),class:"delete-note-btn"},"×",8,X),(0,o.Lk)("strong",null,(0,n.v_)(e.title),1),(0,o.Lk)("p",null,(0,n.v_)(e.content),1)],46,E))),128)),I.newNoteData&&I.newNoteData.page===e[1].id?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"new-note-form",style:(0,n.Tr)({top:I.newNoteData.y+"px",left:I.newNoteData.x+"px"})},[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>I.newNoteData.title=e),placeholder:"Titre",class:"form-control mb-2"},null,512),[[l.Jo,I.newNoteData.title]]),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>I.newNoteData.content=e),placeholder:"Votre note...",class:"form-control mb-2"},null,512),[[l.Jo,I.newNoteData.content]]),(0,o.Lk)("button",{onClick:t[7]||(t[7]=(0,l.D$)((...e)=>$.submitNewNote&&$.submitNewNote(...e),["stop"])),class:"btn btn-sm btn-primary"},"Enregistrer"),(0,o.Lk)("button",{onClick:t[8]||(t[8]=(0,l.D$)((...e)=>$.cancelNewNote&&$.cancelNewNote(...e),["stop"])),class:"btn btn-sm btn-secondary"},"Annuler")],4)):(0,o.Q3)("",!0)],64)):(0,o.Q3)("",!0),(0,o.Lk)("div",_,(0,n.v_)(e[1].page_number),1)],8,f)):((0,o.uX)(),(0,o.CE)("div",x))]))),128))])])):(0,o.Q3)("",!0)])}a(4114);var I=a(5362),$={name:"CatalogDetail",props:{id:{type:String,required:!0}},data(){return{catalog:null,loading:!0,error:null,strapiBaseUrl:"https://strapi.scarpellino.fr",newNoteData:null,isNoteMode:!1,notesLoaded:!1,draggedNote:null}},computed:{pairedPages(){if(!this.catalog||!this.catalog.pages)return[];const e=[...this.catalog.pages].sort((e,t)=>e.page_number-t.page_number),t=[];e.length>0&&t.push([null,e[0]]);for(let a=1;a<e.length;a+=2)a+1<e.length?t.push([e[a],e[a+1]]):t.push([e[a],null]);return t}},async created(){this.fetchInitialData()},methods:{getStrapiMediaUrl(e){return e?`${this.strapiBaseUrl}${e}`:""},async fetchInitialData(){this.loading=!0;try{const e=await I.A.getCatalog(this.id);this.catalog=e.data.data}catch(e){this.error="Erreur lors du chargement du catalogue.",console.error(e)}finally{this.loading=!1}},async toggleNoteMode(){this.isNoteMode=!this.isNoteMode,this.isNoteMode&&!this.notesLoaded&&await this.fetchNotes()},async fetchNotes(){this.loading=!0;try{const e=await I.A.getCatalogWithNotes(this.id);this.catalog=e.data.data,this.notesLoaded=!0}catch(e){this.error="Erreur lors du chargement des notes.",console.error(e)}finally{this.loading=!1}},startNewNote(e,t){if(!this.isNoteMode||!t)return;if(this.newNoteData)return;if(e.target.closest(".note-bubble")||e.target.closest(".new-note-form"))return;const a=e.currentTarget.getBoundingClientRect();this.newNoteData={x:Math.round(e.clientX-a.left),y:Math.round(e.clientY-a.top),page:t.id,title:"",content:""}},async submitNewNote(){if(this.newNoteData&&this.newNoteData.content)try{await I.A.createNote(this.newNoteData),await this.fetchNotes(),this.newNoteData=null}catch(e){console.error("Erreur lors de l'ajout de la note:",e),alert("Erreur lors de l'ajout de la note. Veuillez réessayer.")}else alert("Veuillez saisir un contenu pour la note.")},cancelNewNote(){this.newNoteData=null},async deleteNote(e){if(confirm("Êtes-vous sûr de vouloir supprimer cette note ?"))try{await I.A.deleteNote(e.documentId),await this.fetchNotes()}catch(t){console.error("Erreur lors de la suppression de la note:",t),alert("Erreur lors de la suppression de la note.")}},startDrag(e,t){this.isNoteMode&&(this.draggedNote={note:t,initialX:t.x,initialY:t.y,offsetX:e.clientX-t.x,offsetY:e.clientY-t.y},window.addEventListener("mousemove",this.handleDrag),window.addEventListener("mouseup",this.stopDrag))},handleDrag(e){if(!this.draggedNote)return;e.preventDefault();const{note:t,offsetX:a,offsetY:o}=this.draggedNote;t.x=e.clientX-a,t.y=e.clientY-o},async stopDrag(){if(!this.draggedNote)return;const{note:e,initialX:t,initialY:a}=this.draggedNote;if(window.removeEventListener("mousemove",this.handleDrag),window.removeEventListener("mouseup",this.stopDrag),e.x!==t||e.y!==a)try{await I.A.updateNote(e.documentId,{x:e.x,y:e.y})}catch(o){console.error("Erreur lors de la mise à jour de la position de la note:",o),alert("Impossible de sauvegarder la nouvelle position de la note."),e.x=t,e.y=a}this.draggedNote=null}}},U=a(1241);const Q=(0,U.A)($,[["render",M],["__scopeId","data-v-e680b064"]]);var V=Q}}]);
//# sourceMappingURL=541.1e566569.js.map